---
title: How can the effectiveness of scare-off measure on wild boar be measured? 
subtitle: Semesterproject 022, Patterns and Trends in Environmental Data - Computational Movement Analysis
author: Mathujah Manikkan and Gioele Pinana
output: html_document

---


<!-- You can add  your R Code with Code chunks-->

```{r, echo = FALSE, warning=FALSE, message=FALSE}

# You can set chunk options individually per code chunk, as was done with this
# code chunk.

# echo = FALSE           hides the code from the generated output
# warning = FALSE        hides warnings from the generated output
# message = FALSE        hides messages from the generated output

# To set the setting for all code chunks, use the following code:

knitr::opts_chunk$set(echo = FALSE, warning = FALSE, message = FALSE)

```



```{r, echo = FALSE, warning=FALSE, message=FALSE, results=FALSE}

ipak <- function(pkg){
  new.pkg <- pkg[!(pkg %in% installed.packages()[, "Package"])] 
  if (length(new.pkg)) 
    install.packages(new.pkg, dependencies = TRUE) 
  sapply(pkg, require, character.only = TRUE)
}

packages <- c("ComputationalMovementAnalysisData", "ggplot2", "dplyr", "sf", "forcats", "tidyverse", "lubridate","ggmap", "mapview", "tidyr","terra","tmap")

ipak(packages)

```


<!-- the following is just a placeholder for the title-picture, remove it afterwards!-->
```{r, echo = FALSE, warning=FALSE, message=FALSE}

# Picture

```

## Abstract
Over the past few years, the population of wild boars in Switzerland has increased rapidly. As the number of wild boars increases, so does the damage to agriculture, as they seek for food in the fields. To counteract this damage, new preventive measures such as hunt, schreck, staged shots and so on have been developed with the aim of preventing the wild boars from entering the fields. Within this semester project we want to measure the effectiveness of the scare-off measure schreck. The Zurich University of Applied Sciences provided us with three datasets for our research. One dataset contains the coordinates of 98 wild boars in Fenel in region of Bern, Switzerland over the period from May 2014 to October 2016. The other two datasets contains the coordinates of the scare positions and time intervals when the scare was turned on and off. To investigate the question of their effectiveness, two different methods are analyzed and at the end critically discussed on their advantages and disadvantages. 


## Introduction
Until 1945, only a few animals arrive in Switzerland from Germany, France and Italy. Between 1945 and 1952 more frequent wild boars were then recorded in Switzerland. However, the population was not able to establish itself until between 1970 and 1990. Since 1990, the population of wild boars has been growing strongly, as evidenced by the number of animals shot and killed in traffic accidents. Possible reasons for the strong population increase are milder winters, an additional number of fattening years as well as the almost inexhaustible and mostly freely available food supply on agricultural land. Based on the planned realization of wildlife passages, it is assumed that the population will expand in the Central Plateau as well as in the Pre-Alps in the next few years. (Graf R.F and Fischer C.(Hrsg.), 2021)

Wild boars are omnivores and spend a large part of their time searching for food, covering an average of 5 km per night. Wild boars are mainly active during the night and as the only representative of the cloven-hoofed animals, they can reach food in the ground. To do this, it digs up the top layer of soil to a depth of 20-60 cm with its snout disc, which is ideally suited for this purpose. In the soil wild boars find large quantities of invertebrates and roots, but also mice, the nests and supplies. Wild boars also find a large part of their food on agricultural land. Particularly popular are corn, wheat and canola. Over the summer and in the fall wild boars eat fat, from which they can then feed over the meager winter months and also in the spring. Wild boars are very loyal to their location, but do not defend a territory. Thus, several herds can be on the move in the same area. Aggressive behavior between the rods occurs only when they occur at the same time at a food source. Depending on the region, the activity areas vary in size, with 2.5-12 km2 for males and 4.5-30 km2 for does. (Graf R.F and Fischer C.(Hrsg.), 2021) 

Agricultural fields can be protected with prevention methods such as electric fencing clasping closures and hunt (Graf R.F and Fischer C.(Hrsg.), 2021). However, there is currently no prevention method that works 100%. Potential reasons for this can be related to the different behavioral and movement patterns of wild boar. Since the existing methods are still complex and expensive, researchers at the Zurich University of Applied Sciences have therefore developed an acoustic method called "Schreck". In this method, alarm and warning calls of wild boars are reproduced in order to keep wild boars away from entering fields and prevent damage. The acoustic wild boar scare now provides a flexible and intelligent prevention method. This thesis examines the effectiveness of this new prevention method in order to enable sustainable wild boar management (Suter S. 20XX).This can not only prevent direct conflicts, but also indirectly limit accessible population growth. (Graf R.F and Fischer C.(Hrsg.), 2021)

## Material and Methods
Within this semester project, two methods are analyzed in order to determine the effectiveness of the scare method and their strengths and weaknesses are compared

### Methods

* **(A) Method**: The first approach compares the mean distance between wild boar and schreck-locations, when turned on and when turned off. Therefore we measure a statistical effectiveness using p-value: 
*define relevant schreck-locations : the ones near the wild boar 
*choose 3 wild board to do the analysis
*calculate distances 
*t-Test and box-plot 

* **(B) Method**: The second approach analyzes the presence of wild boars by selected agricultural fields. Thereby, it is examined which wild boars were observed in the selected field before the activation of the scare and if and how often they were observed in the same field after the activation. Based on this analysis, a conclusion can be made by statistical analysis (P-value). 

### Datasets
#### Dataset wildschweine_BE 
The Zurich University of Applied Sciences provided us with tree required datasets for our research. The dataset "wildschwein_BE" contains the coordinates of 98 wild boars in Fenel in region of Bern, Switzerland over the period from May 2014 to October 2016. As can be seen from the following table, the coordinates of the wild boars were collected every 15 minutes.Each fix point in the dataset contains the apperent attributes (TierID, TierName, CollarID, DatetimeUTC, E, N, day and moonilumination)
```{r, echo = FALSE, warning=FALSE, message=FALSE}

# Include tables with the function "kable"
knitr::kable(head(wildschwein_BE))

```


#### Dataset schreck_locations and schreck_agenda
The second "schreck_locations" and third "schreck_agenda" datasets contain the coordinates of the schreck-positions and time intervals when the scare was turned on and off. In a futher step, the two data sets were joined into one data set using a left join.
<br><br>
schreck_locations
Each fix point in the dataset contains the apperent attributes (id, region, flurname, kultur, installationshohe, zaun, jagddruck, lat and lon)
```{r, echo = FALSE, warning=FALSE, message=FALSE}

knitr::kable(head(schreck_locations))

```

schreck_agenda
Each fix point in the dataset contains the apperent attributes (id, datum_on, datum_off, modus, lautstaerke, intervall, ausrichtung_min, ausrichtung_max and phase)
```{r, echo = FALSE, warning=FALSE, message=FALSE}

knitr::kable(head(schreck_agenda))

```

### Pre-processing
#### Dataset wildschweine_BE 
Based on a sampling analysis, GPS collars for wild boar are aheaded to a complex sampling procedure. This can be seen in the following figure. 

Sample regime
<br><br>
```{r, echo = FALSE, warning=FALSE, message=FALSE}

par(mfrow = c(2,2))
# Sample regime
limits <- c(0,200)
breaks = seq(0,200,50)
labels = paste(c(rep("",length(breaks)-1),">"), breaks)

wildschwein_BE %>%
  mutate(TierName = fct_reorder(TierName, DatetimeUTC,min, .desc = TRUE)) %>%
  group_by(TierID, TierName, CollarID) %>%
  mutate(
    timelag = as.numeric(difftime(lead(DatetimeUTC),DatetimeUTC, units = "mins")),
  ) %>%
  ggplot(aes(DatetimeUTC, TierName, colour = timelag)) +
  geom_line(lwd = 10) +
  scale_color_gradientn(name = "Sampling interval", colours = RColorBrewer::brewer.pal(11, "Spectral"), limits = limits, na.value = NA, oob = scales::squish, breaks = seq(0,200,50), labels = labels) +
  theme_minimal() +
  theme(legend.position = "top") +
  guides(color = guide_colorbar(title.position = "top", title.hjust = .5, barwidth = unit(20, "lines"), barheight = unit(.5, "lines")))

```

The wild boars were caught sequentially. Based on a temporal overlap analysis, it is clear that some of them do not overlap. 

Temporal Overlap
<br><br>
```{r, echo = FALSE, warning=FALSE, message=FALSE}

sampling_periods <- wildschwein_BE %>%
  group_by(TierID, TierName, CollarID) %>%
  summarise(
    min = min(DatetimeUTC),
    max = max(DatetimeUTC)
  )


wildschwein_overlap_temp <- wildschwein_overlap_temp %>%
  left_join(sampling_periods, by = c("TierID", "TierName", "CollarID"))


wildschwein_overlap_temp %>%
  mutate(TierCollar = paste(TierName, CollarID)) %>%
  ggplot(aes(xmin = min, xmax = max, y = TierCollar)) +
  geom_errorbarh() +
  facet_grid(Groups~., scales = "free_y", space = "free_y")

```


A spatial overlay analysis was created to identify the movement behavior of wild boars. This is shown in the following plot. 

Spatial Overlap
<br><br>
```{r, echo = FALSE, warning=FALSE, message=FALSE}
wildschwein_sf <- wildschwein_BE %>%
  st_as_sf(coords = c("E", "N"), crs = 2056) %>%
  mutate(tiercollar = paste(TierID, TierName, CollarID)) 


wildschwein_convex_hull <- wildschwein_sf %>%
  group_by(TierID, TierName, CollarID) %>%
  summarise() %>%
  st_convex_hull()


wildschwein_convex_hull %>%
  mutate(tiercollar = paste(TierID, TierName, CollarID)) %>%
  ggplot(aes(fill = factor(TierID))) + geom_sf(alpha = 0.1) +
  coord_sf(datum = 2056) +
  facet_wrap(~tiercollar) +
  theme(legend.position = "none")

```

Afterwards the coordinates of the schreck locations from GPS to CH1903+ / LV95 were changed. For this purpose, the dataframe was first transformed into a spatial object. Using different spatial plots of the wild boars as well as the schreck coordinates, suitable schreck locations were manually selected. These following schrecks are suitable for our analysis:

* WSS_2016_05
* WSS_2016_01
* WSS_2016_13
* WSS_2016_06
* WSS_2015_01
* WSS_2015_03
* WSS_2015_04
* WSS_2014_04
* WSS_2014_05
* WSS_2014_06
* WSS_2017_02
* WSS_2017_01
* WSS_2017_09
* WSS_2017_07
* WSS_2017_03
* WSS_2017_04

The dataframe was now filtered on the basis of the selected schrecks. In order to analyze the wild boars individually, in a further step singel dataframes with the respective names of the wild boars were created. Since the dataset "wildboar_BE" contains 98 different wild boars, only 19 wild boars were selected for working further in this analysis. The selected wild boars are (Ueli, Sabine, Caroline, Isabelle, Rosa, Ruth, Miriam, Fritz, Claude, Franz, Amos, Nicole, Venus, Evelin, Gaby, Frida, Donar, Joanna).

```{r, echo = FALSE, warning=FALSE, message=FALSE, , fig.show='hide'}

## first transform dataframe into a spatial object
schreck_locations_swiss_coord <- st_as_sf(schreck_locations, 
                              coords = c("lon", "lat"), 
                              crs = 4326)
## Now coordinate transformation
schreck_locations_swiss_coord <- st_transform(schreck_locations_swiss_coord, 2056)

## Transform Wildschwein_BE as weel into a spatial object 
wildschwein_BE_spatial <- st_as_sf(wildschwein_BE, 
                                          coords = c("E", "N"), 
                                          crs = 2056)

schreck_locations_swiss_coord <- st_as_sf(schreck_locations, 
                              coords = c("lon", "lat"), 
                              crs = 4326)
## Now coordinate transformation
schreck_locations_swiss_coord <- st_transform(schreck_locations_swiss_coord, 2056)

## Transform Wildschwein_BE as weel into a spatial object 
wildschwein_BE_spatial <- st_as_sf(wildschwein_BE, 
                                          coords = c("E", "N"), 
                                          crs = 2056)


## Plotting the location of the schreck locations
ggplot(schreck_locations_swiss_coord)+
  geom_sf() +
  coord_sf(datum = 2056) 

## Plotting wild board together with schreck locations 
ggplot()+
  geom_sf(data = schreck_locations_swiss_coord) +
  geom_sf(data = wildschwein_BE_spatial, aes(color = "red")) +
  coord_sf(datum = 2056)

## Plotting the location of the schreck with the corresponding ID, to select the important ones
ggplot(schreck_locations_swiss_coord, label = "id")+
  geom_sf() +
  coord_sf(datum = 2056)+
  geom_sf_text(aes(label = id, check_overlap = TRUE)) +
  scale_y_continuous(limits=c(1206500,1207000)) +
  scale_x_continuous(limits=c(2570000,2571000))

## select important scare-off 
# the following scare-off location are the ones near the wild boards studied and therefore 
# they could be suitable for the analysis. 
target2 = c("WSS_2016_05", "WSS_2016_01", "WSS_2016_13", "WSS_2016_06", "WSS_2015_01","WSS_2015_03","WSS_2015_04","WSS_2014_04","WSS_2014_05","WSS_2014_06","WSS_2017_02","WSS_2017_01","WSS_2017_09","WSS_2017_07","WSS_2017_03","WSS_2017_04")

schrecks <- schreck_locations_swiss_coord %>%
  filter(id %in% target2)

## plot the important scare-off
ggplot(schrecks)+
  geom_sf() +
  coord_sf(datum = 2056)

## create dataframe with single wild board 
Ueli <- wildschwein_BE_spatial %>%
  filter(TierName == "Ueli")
Sabine <- wildschwein_BE_spatial %>%
  filter(TierName == "Sabine")
Caroline <- wildschwein_BE_spatial %>%
  filter(TierName == "Caroline")
Isabelle <- wildschwein_BE_spatial %>%
  filter(TierName == "Isabelle")
Rosa <- wildschwein_BE_spatial %>%
  filter(TierName == "Rosa")
Ruth <- wildschwein_BE_spatial %>%
  filter(TierName == "Ruth")
Miriam <- wildschwein_BE_spatial %>%
  filter(TierName == "Miriam")
Fritz <- wildschwein_BE_spatial %>%
  filter(TierName == "Fritz")
Claude <- wildschwein_BE_spatial %>%
  filter(TierName == "Claude")
Olga <- wildschwein_BE_spatial %>%
  filter(TierName == "Olga")
Franz <- wildschwein_BE_spatial %>%
  filter(TierName == "Franz")
Amos <- wildschwein_BE_spatial %>%
  filter(TierName == "Amos")
Nicole <- wildschwein_BE_spatial %>%
  filter(TierName == "Nicole")
Venus <- wildschwein_BE_spatial %>%
  filter(TierName == "Venus")
Evelin <- wildschwein_BE_spatial %>%
  filter(TierName == "Evelin")
Gaby <- wildschwein_BE_spatial %>%
  filter(TierName == "Gaby")
Frida <- wildschwein_BE_spatial %>%
  filter(TierName == "Frida")
Donar <- wildschwein_BE_spatial %>%
  filter(TierName == "Donar")
Joanna <- wildschwein_BE_spatial %>%
  filter(TierName == "Joanna")


## Join two schreck dataframes
schreck2 <- left_join(schrecks,schreck_agenda,by="id")
```


Further analyses with the help of plots show that especially the three wild boars Caroline, Miriam and Frida were frequently in the surroundings of the schreck WSS_2016_01. For this reason, the schreck WSS_2016_01 and the three wild boars were selected for the further analysis. The following three plots show the trajectories of the respective wild boars. The black points indicate the fright locations, in which the dense cover surrounding WSS_2016_01 can be clearly seen. 
<br><br>
```{r, echo = FALSE, warning=FALSE, message=FALSE}
## plotting single trajectories with schreck-locations
# in this graphs choose which schreck are suitable for the anaylsis 
# (the ones near the location of the wild board location)
## check if the telemetry period correspond to the time where schreck are active or not 
# There has to be a period before the schreck it is turned on and a period after the schreck it is turned off
# The following Wild boar are suitable for the analysis!!

# Caroline sieht realitv gut aus mit WSS_2016_01
ggplot()+
  geom_sf(data = schreck2) +
  geom_sf(data = Caroline, aes(color = "Caroline")) +
  # geom_sf_label(data = schreck2, aes(label = id)) +
  geom_sf_text(data = schreck2, aes(label = id), size=2, check_overlap = TRUE) +
  coord_sf(datum = 2056)+
  labs(colour = "Legend", title = "Single trajectories with schreck-locations", subtitle = "Wild boar: Caroline")


# Miriam sieht perfekt aus mit WSS_2016_01
ggplot()+
  geom_sf(data = schreck2) +
  geom_sf(data = Miriam, aes(color = "Miriam")) +
  # geom_sf_label(data = schreck2, aes(label = id)) +
  geom_sf_text(data = schreck2, aes(label = id), size=2, check_overlap = TRUE) +
  coord_sf(datum = 2056)+
  labs(colour = "Legend", title = "Single trajectories with schreck-locations", subtitle = "Wild boar: Miriam")


# Frida sieht perfekt aus mit WSS_2016_01
ggplot()+
  geom_sf(data = schreck2) +
  geom_sf(data = Frida, aes(color = "Frida")) +
  # geom_sf_label(data = schreck2, aes(label = id)) +
  geom_sf_text(data = schreck2, aes(label = id), size=2, check_overlap = TRUE) +
  coord_sf(datum = 2056)+
  labs(colour = "Legend", title = "Single trajectories with schreck-locations", subtitle = "Wild boar: Frida")

```


### Method 1


The first approach compares the mean distance between wild boar and schreck-locations, when turned on and when turned off. Therefore we measure a statistical effectiveness using p-value: 
*define relevant schreck-locations : the ones near the wild boar 
*choose 3 wild board to do the analysis
*calculate distances 
*t-Test and box-plot 

Within the first approch the mean distance will compared 


```{r, echo = FALSE, warning=FALSE, message=FALSE, , fig.show='hide'}

####################################################################################
#### APPROACH 1 ####
####################################################################################


### CAROLINE 2016_01  ####
Caroline <- Caroline %>%
  mutate(Date = as.Date(DatetimeUTC),
         Schreck = case_when(Date < as.Date("2016-04-04") ~ "off before",
                             Date >= as.Date("2016-04-04") & Date <= as.Date("2016-04-23") ~ "on",
                             Date > as.Date("2016-04-23") ~ "off after"),
         X = unlist(map(Caroline$geometry,1)),
         Y = unlist(map(Caroline$geometry,2)),
         distance = sqrt((X-2570935)^2+(Y-1205197)^2)) 
         
# Boxplot Caroline
ggplot(Caroline, aes(Schreck, distance)) +
  geom_boxplot() +
  theme_classic() +
  labs(title = "Mean distance between wild boar and scare-off", subtitle = "Caroline")+
  xlab("Mode scare-off") + ylab("Distance")


# ANOVA Caroline

Caroline_off_before <- Caroline %>%
  filter(Schreck == "off before")
  
Caroline_on <- Caroline %>%
  filter(Schreck == "on")

Caroline_off_after <- Caroline %>%
  filter(Schreck == "off after")


### MIRIAM 2016_01 ####
Miriam <- Miriam %>%
  mutate(Date = as.Date(DatetimeUTC),
         Schreck = case_when(Date < as.Date("2016-04-04") ~ "off before",
                             Date >= as.Date("2016-04-04") & Date <= as.Date("2016-04-23") ~ "on",
                             Date > as.Date("2016-04-23") ~ "off after"),
         X = unlist(map(Miriam$geometry,1)),
         Y = unlist(map(Miriam$geometry,2)),
         distance = sqrt((X-2570935)^2+(Y-1205197)^2)) 
         
# Boxplot Miriam
ggplot(Miriam, aes(Schreck, distance)) +
  geom_boxplot() +
  theme_classic() +
  labs(title = "Mean distance between wild boar and scare-off", subtitle = "Miriam")+
  xlab("Mode scare-off") + ylab("Distance")


# ANOVA Miriam

### FRIDA 2016_01 ####
Frida <- Frida %>%
  mutate(Date = as.Date(DatetimeUTC),
         Schreck = case_when(Date < as.Date("2016-04-04") ~ "off before",
                             Date >= as.Date("2016-04-04") & Date <= as.Date("2016-04-23") ~ "on",
                             Date > as.Date("2016-04-23") ~ "off after"),
         X = unlist(map(Frida$geometry,1)),
         Y = unlist(map(Frida$geometry,2)),
         distance = sqrt((X-2570935)^2+(Y-1205197)^2)) 

# Boxplot Frida
ggplot(Frida, aes(Schreck, distance)) +
  geom_boxplot() +
  theme_classic() +
  labs(title = "Mean distance between wild boar and scare-off", subtitle = "Frida")+
  xlab("Mode scare-off") + ylab("Distance")


# ANOVA Frida



```


### Method 2

For the second approach, the data package "Feldaufnahmen_Fanel" was additionally used, which subdivides the land cover resp. the type of agricultural area of the nature reserve Fanel. From the figure it can be concluded that the suitable schreck WSS_2016_01 is located on the grassland area No.2 (German: Wiese Nr. 2). Grassland areas are optimal for our research question, since wild boars spoil the ground during their search for food.


```{r, echo = FALSE, warning=FALSE, message=FALSE, , fig.show='hide'}

#### APPROACH 1 ####
# Download crop data 
crop_fanel <- read_sf("Feldaufnahmen_Fanel.gpkg")

```


```{r, echo = FALSE, warning=FALSE, message=FALSE}
# Visualization
WSS_2016_01 <- schreck2 %>%
  filter(id == "WSS_2016_01")


ggplot(crop_fanel) +
  geom_sf(aes(fill = Frucht)) +
  geom_sf(data = WSS_2016_01) +
  geom_sf_text(data = WSS_2016_01, aes(label = id), size=3, color= "white", check_overlap = TRUE)+
  geom_sf_text(data = crop_fanel, aes(label = FieldID), size =1.2) +
  labs(title = "Diffrent crop-types in Fenel", subtitle = "Schreck-Location WSS_2016_01")

# Our schreck WSS_2016_01 is located in "Wiese number 2"
```

Subsequently, to check for spatial overlap, the datasets of the 3 selected wild boars were merged with the dataset "Feldaufnahmen_Fanel". 

Caroline

```{r, echo = FALSE, warning=FALSE, message=FALSE}
Caroline <-  st_join(Caroline, crop_fanel)
Caroline

ggplot(crop_fanel) +
  geom_sf(aes(fill = Frucht)) +
  geom_sf(data = Caroline) +
  geom_sf(data = WSS_2016_01) +
  geom_sf_text(data = WSS_2016_01, aes(label = id), size=3, color= "white", check_overlap = TRUE) +
  labs(title = "Diffrent crop-types in Fenel", subtitle = "wild boar: Caroline")

# Visual exploration for Caroline (only most relevant "Frucht" displayed!!!)
Caroline_2 <- Caroline %>%
  st_set_geometry(NULL) %>%
  mutate(
    hour = hour(round_date(DatetimeUTC,"hour")),
    Frucht = ifelse(is.na(Frucht),"other",Frucht),
    Frucht = fct_lump(Frucht, 5,other_level = "other"),
  ) %>%
  group_by(Schreck,hour,Frucht) %>%
  count() %>%
  ungroup() %>%
  group_by(Schreck,hour) %>%
  mutate(perc = n / sum(n)) %>%
  ungroup() %>%
  mutate(
    Frucht = fct_reorder(Frucht, n,sum, desc = TRUE)
  )


ggplot(Caroline_2, aes(hour,perc, fill = Frucht)) +
  geom_col(width = 1) +
  scale_y_continuous(name = "Percentage", labels = scales::percent_format()) +
  scale_x_continuous(name = "Time (rounded to the nearest hour)") +
  facet_wrap(~Schreck ) +
  theme_classic() +
  labs(title = "Percentages of samples in a given crop per hour",subtitle = "Only showing the most common categories")


```

Miriam
```{r, echo = FALSE, warning=FALSE, message=FALSE}

# Miriam
Miriam <-  st_join(Miriam, crop_fanel)
Miriam

ggplot(crop_fanel) +
  geom_sf(aes(fill = Frucht)) +
  geom_sf(data = Miriam) +
  geom_sf(data = WSS_2016_01) +
  geom_sf_text(data = WSS_2016_01, aes(label = id), size=3, color= "white", check_overlap = TRUE)+
  labs(title = "Diffrent crop-types in Fenel", subtitle = "wild boar: Miriam")

# Visual exploration for Miriam 
Miriam_2 <- Miriam %>%
  st_set_geometry(NULL) %>%
  mutate(
    hour = hour(round_date(DatetimeUTC,"hour")),
    Frucht = ifelse(is.na(Frucht),"other",Frucht),
    Frucht = fct_lump(Frucht, 5,other_level = "other"),
  ) %>%
  group_by(Schreck,hour,Frucht) %>%
  count() %>%
  ungroup() %>%
  group_by(Schreck,hour) %>%
  mutate(perc = n / sum(n)) %>%
  ungroup() %>%
  mutate(
    Frucht = fct_reorder(Frucht, n,sum, desc = TRUE)
  )


ggplot(Miriam_2, aes(hour,perc, fill = Frucht)) +
  geom_col(width = 1) +
  scale_y_continuous(name = "Percentage", labels = scales::percent_format()) +
  scale_x_continuous(name = "Time (rounded to the nearest hour)") +
  facet_wrap(~Schreck ) +
  theme_classic() +
  labs(title = "Percentages of samples in a given crop per hour",subtitle = "Only showing the most common categories")


```


Frida
```{r, echo = FALSE, warning=FALSE, message=FALSE}

# Frida

Frida <-  st_join(Frida, crop_fanel)
Frida

ggplot(crop_fanel) +
  geom_sf(aes(fill = Frucht)) +
  geom_sf(data = Frida) +
  geom_sf(data = WSS_2016_01) +
  geom_sf_text(data = WSS_2016_01, aes(label = id), size=3, color= "white", check_overlap = TRUE)+
  labs(title = "Diffrent crop-types in Fenel", subtitle = "wild boar: Frida")

# Visual exploration for Frida 
Frida_2 <- Frida %>%
  st_set_geometry(NULL) %>%
  mutate(
    hour = hour(round_date(DatetimeUTC,"hour")),
    Frucht = ifelse(is.na(Frucht),"other",Frucht),
    Frucht = fct_lump(Frucht, 5,other_level = "other"),
  ) %>%
  group_by(Schreck,hour,Frucht) %>%
  count() %>%
  ungroup() %>%
  group_by(Schreck,hour) %>%
  mutate(perc = n / sum(n)) %>%
  ungroup() %>%
  mutate(
    Frucht = fct_reorder(Frucht, n,sum, desc = TRUE)
  )


ggplot(Frida_2, aes(hour,perc, fill = Frucht)) +
  geom_col(width = 1) +
  scale_y_continuous(name = "Percentage", labels = scales::percent_format()) +
  scale_x_continuous(name = "Time (rounded to the nearest hour)") +
  facet_wrap(~Schreck ) +
  theme_classic() +
  labs(title = "Percentages of samples in a given crop per hour",subtitle = "Only showing the most common categories")

```



Calculation approach 2: WSS_2016_01 was on for 19 days consecutive. So that a comparison has sense, we filter the period from 19 days before the schreck was turned on and 19 days after!

Statistische Test? oder nur vergleich der Anzahl Punkte?

```{r, echo = FALSE, warning=FALSE, message=FALSE}

###  Visualization of the "Streifgebiet"
# Calculate Convex Hull for the 3 selected wild boars
wildschwein_BE_spatial_smry <- wildschwein_BE_spatial %>%
  filter(TierName %in% c("Caroline", "Miriam", "Frida")) %>%
  group_by(TierName) %>%
  summarise()

mcp <- st_convex_hull(wildschwein_BE_spatial_smry) 

# Import raster data
pk100_BE <- terra::rast("pk100_BE (2).tif")

# Plot interactive map
tmap_mode("view")
tm_shape(mcp) +
  tm_polygons(col = "TierName",alpha = 0.4,border.col = "red") +
  tm_legend(bg.color = "white") 


# Caroline 
Caroline_approach2 <- Caroline %>%
  st_set_geometry(NULL) %>%
  filter(Date > as.Date("2016-03-16")) %>%
  filter(Date < as.Date("2016-05-12")) %>%
  group_by(Schreck, FieldID) %>%
  summarise(total = sum(FieldID)) %>%
  filter(FieldID == 2)
## Beim Caroline gibt es nicht Data w√§hrend und nacher.... wir verwenden nur Miriam und Frida

# Miriam
Miriam_approach2 <- Miriam %>%
  st_set_geometry(NULL) %>%
  filter(Date > as.Date("2016-03-16")) %>%
  filter(Date < as.Date("2016-05-12")) %>%
  group_by(Schreck, FieldID) %>%
  summarise(total = sum(FieldID)) %>%
  filter(FieldID == 2)

# Frida
Frida_approach2 <- Frida %>%
  st_set_geometry(NULL) %>%
  filter(Date > as.Date("2016-03-16")) %>%
  filter(Date < as.Date("2016-05-12")) %>%
  group_by(Schreck, FieldID) %>%
  summarise(total = sum(FieldID)) %>%
  filter(FieldID == 2)


```



###  Problems and limitations
In our analysis, three female wild boars were selected based on their movement patterns. Since the behavior of female and male wild boars differs, the analysis with male wild boars would have been quite useful as a comparison. However, this was not possible within the framework of this work, but it may be considered for a future work.

## Results

Compare Mode on and off
```{r, echo = FALSE, warning=FALSE, message=FALSE}
```

<!-- the following is just a placeholder text, remove it!-->
Philosophy oneself passion play fearful self noble zarathustra deceptions sexuality. Endless ocean of oneself dead ocean. Selfish decrepit.

## Discussion

<!-- the following is just a placeholder text, remove it!-->
Justice convictions spirit sexuality insofar free marvelous joy. Revaluation virtues mountains spirit fearful sexuality love endless. Society intentions will noble burying aversion moral. Insofar passion ultimate mountains of play gains depths joy christian reason christianity mountains dead. Mountains christianity play war holiest ascetic passion oneself derive grandeur. Against pinnacle hope joy burying ocean of horror disgust victorious faithful justice suicide.

-only female wildboars
-analyse 98 to 19 to three
-

## Reference




